@model CabinetMedicalWeb.Areas.Medical.Models.DossierCompletViewModel

@{
    ViewData["Title"] = $"{Model.PatientInfo.Nom} {Model.PatientInfo.Prenom} - Medical Record";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var age = (int)Math.Floor((DateTime.Now - Model.PatientInfo.DateNaissance).TotalDays / 365.25);
    var consultationsCount = Model.Consultations?.Count() ?? 0;
    var prescriptionsCount = Model.Prescriptions?.Count() ?? 0;
    var examensCount = Model.Examens?.Count() ?? 0;
    var totalEntries = consultationsCount + prescriptionsCount + examensCount;
}

<style>
    .medical-dashboard {
        --primary: #7AA3D1;
        --primary-light: #A7CBED;
        --secondary: #666B72;
        --danger: #EF4444;
        --surface: #FFFFFF;
        --bg: #E9EFF7;
        --border: #D4DEEC;
        --text-main: #666B72;

        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        padding: 0 1.5rem 3rem 1.5rem;
        color: var(--text-main);
    }

    .patient-header {
        background: linear-gradient(120deg, var(--primary) 0%, #91B3D9 100%);
        border-radius: 24px;
        padding: 2.5rem;
        color: white;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 25px -5px rgba(79, 70, 229, 0.4);
    }

    .patient-header::after {
        content: '';
        position: absolute;
        top: -50px;
        right: -50px;
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        border-radius: 50%;
        pointer-events: none;
    }

    .header-grid {
        display: grid;
        grid-template-columns: auto 1fr auto;
        gap: 2rem;
        align-items: center;
        position: relative;
        z-index: 1;
    }

    .patient-avatar {
        width: 110px;
        height: 110px;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(8px);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
        font-weight: 700;
        color: white;
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }

    .patient-identity h1 {
        font-size: 2.25rem;
        font-weight: 800;
        margin: 0 0 0.5rem 0;
        letter-spacing: -0.02em;
        line-height: 1.2;
    }

    .patient-badges {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .p-badge {
        background: rgba(255, 255, 255, 0.15);
        padding: 0.35rem 0.85rem;
        border-radius: 50px;
        font-size: 0.85rem;
        font-weight: 500;
        backdrop-filter: blur(4px);
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
    }

    .patient-contact {
        display: flex;
        gap: 1.5rem;
        font-size: 0.95rem;
        opacity: 0.9;
        flex-wrap: wrap;
    }

    .contact-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .header-actions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        min-width: 200px;
    }

    .btn-action-primary {
        background: white;
        color: var(--primary);
        border: none;
        padding: 0.85rem 1.5rem;
        border-radius: 12px;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.2s;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        text-decoration: none;
    }

    .btn-action-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        background: #F8FAFC;
        color: var(--primary);
        text-decoration: none;
    }

    .btn-action-secondary {
        background: rgba(255,255,255,0.15);
        color: white;
        border: 1px solid rgba(255,255,255,0.3);
        padding: 0.6rem 1rem;
        border-radius: 10px;
        font-size: 0.9rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        transition: all 0.2s;
        backdrop-filter: blur(4px);
        text-decoration: none;
    }

    .btn-action-secondary:hover {
        background: rgba(255,255,255,0.25);
        text-decoration: none;
        color: white;
    }

    .medical-alert {
        background: #FEF2F2;
        border-left: 5px solid var(--danger);
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 2rem;
        display: flex;
        gap: 1rem;
        align-items: flex-start;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .medical-alert i { color: var(--danger); font-size: 1.5rem; margin-top: 0.1rem; }
    .medical-alert-content h4 { color: #991B1B; font-size: 1rem; font-weight: 700; margin: 0 0 0.25rem 0; }
    .medical-alert-content p { color: #7F1D1D; margin: 0; font-size: 0.95rem; line-height: 1.5; }

    .stats-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2.5rem;
    }

    .stat-card {
        background: var(--surface);
        padding: 1.5rem;
        border-radius: 16px;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        border-color: #CBD5E1;
    }

    .stat-icon {
        width: 56px;
        height: 56px;
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        flex-shrink: 0;
    }

    .bg-indigo { background: linear-gradient(135deg, #6366F1, #4338CA); }
    .bg-green { background: linear-gradient(135deg, #34D399, #059669); }
    .bg-purple { background: linear-gradient(135deg, #A78BFA, #7C3AED); }
    .bg-orange { background: linear-gradient(135deg, #FBBF24, #D97706); }

    .stat-info .count { font-size: 1.75rem; font-weight: 800; line-height: 1; color: #1E293B; }
    .stat-info .label { color: var(--secondary); font-size: 0.85rem; font-weight: 500; margin-top: 0.25rem; }

    .content-layout { display: grid; grid-template-columns: 1fr 400px; gap: 2rem; }

    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
    .section-title { font-size: 1.25rem; font-weight: 700; color: #1E293B; display: flex; align-items: center; gap: 0.75rem; }
    .section-title i { color: var(--primary); }

    .timeline { position: relative; padding-left: 2rem; }
    .timeline::before { content: ''; position: absolute; left: 7px; top: 0; bottom: 0; width: 2px; background: #E2E8F0; }
    .timeline-item { position: relative; margin-bottom: 2rem; }
    .timeline-dot { position: absolute; left: -2.4rem; top: 0.25rem; width: 16px; height: 16px; background: var(--surface); border: 3px solid var(--primary); border-radius: 50%; z-index: 2; }
    .timeline-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 1.5rem; transition: all 0.2s; }
    .timeline-card:hover { border-color: var(--primary); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
    .t-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; border-bottom: 1px solid #F1F5F9; padding-bottom: 1rem; }
    .t-date { display: flex; flex-direction: column; text-align: right; }
    .t-date .day { font-weight: 800; font-size: 1.25rem; color: #1E293B; line-height: 1; }
    .t-date .my { font-size: 0.8rem; color: var(--secondary); text-transform: uppercase; font-weight: 600; margin-top: 2px; }
    .t-title h4 { margin: 0; font-size: 1.1rem; font-weight: 700; color: #1E293B; }
    .t-title .time { font-size: 0.85rem; color: var(--secondary); }
    .t-body { color: #475569; font-size: 0.95rem; line-height: 1.6; margin-bottom: 1rem; }
    .t-footer { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; }
    .doctor-pill { background: #F1F5F9; color: #475569; padding: 0.25rem 0.75rem; border-radius: 6px; font-weight: 600; }

    .sidebar-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 1.25rem; margin-bottom: 1.5rem; }
    .mini-list-item { background: #F8FAFC; border: 1px solid var(--border); border-radius: 12px; padding: 1rem; margin-bottom: 0.75rem; transition: transform 0.2s; }
    .mini-list-item:hover { transform: translateX(4px); border-color: #CBD5E1; }
    .item-header { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--secondary); font-weight: 600; margin-bottom: 0.5rem; }
    .item-body { font-weight: 500; color: #334155; font-size: 0.9rem; margin-bottom: 0.5rem; }
    .item-footer { display: flex; gap: 0.5rem; }
    .badge-info { background: #E0F2FE; color: #0369A1; padding: 0.25rem 0.6rem; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }

    .quick-actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
    .btn-quick { background: white; border: 1px solid var(--border); padding: 1rem; border-radius: 12px; text-align: center; transition: all 0.2s; cursor: pointer; color: var(--secondary); }
    .btn-quick:hover { background: var(--primary-light); border-color: var(--primary); color: white; }
    .btn-quick i { display: block; font-size: 1.25rem; margin-bottom: 0.5rem; }
    .btn-quick span { font-size: 0.8rem; font-weight: 600; }

    .folder-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.25rem; margin-top: 1.5rem; }
    .folder-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 1.25rem; box-shadow: 0 6px 14px -6px rgba(15, 23, 42, 0.12); }
    .folder-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .folder-head h4 { margin: 0; font-size: 1.05rem; font-weight: 800; color: #0F172A; }
    .folder-head p { margin: 0; color: var(--secondary); font-size: 0.9rem; }
    .badge-soft { background: #EEF2FF; color: #4338CA; padding: 0.35rem 0.8rem; border-radius: 999px; font-weight: 700; font-size: 0.85rem; }

    .data-table { width: 100%; border-collapse: separate; border-spacing: 0; }
    .data-table th { text-align: left; font-size: 0.78rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--secondary); padding: 0.4rem 0.25rem; border-bottom: 1px solid var(--border); }
    .data-table td { padding: 0.55rem 0.25rem; vertical-align: top; color: #1F2937; }
    .data-table tr + tr td { border-top: 1px dashed var(--border); }
    .pill-muted { background: #ECFEFF; color: #0E7490; padding: 0.25rem 0.6rem; border-radius: 6px; font-weight: 700; font-size: 0.8rem; }
    .text-dim { color: var(--secondary); font-size: 0.9rem; }
    .truncate-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    @media (max-width: 992px) {
        .content-layout { grid-template-columns: 1fr; }
        .stats-row { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
        .header-grid { grid-template-columns: 1fr; text-align: center; gap: 1.5rem; }
        .patient-avatar { margin: 0 auto; }
        .patient-badges, .patient-contact { justify-content: center; }
        .header-actions { width: 100%; }
        .stats-row { grid-template-columns: 1fr; }
        .timeline { padding-left: 1.5rem; }
    }
</style>

<div class="medical-dashboard" style="background: linear-gradient(180deg, var(--bg) 0%, #F4F7FC 100%);">
    <div class="patient-header">
        <div class="header-grid">
            <div class="patient-avatar">
                @Model.PatientInfo.Prenom.FirstOrDefault()@Model.PatientInfo.Nom.FirstOrDefault()
            </div>

            <div class="patient-identity">
                <h1>@Model.PatientInfo.Nom @Model.PatientInfo.Prenom</h1>
                <div class="patient-badges">
                    <span class="p-badge"><i class="fas fa-birthday-cake"></i> @age ans</span>
                    <span class="p-badge"><i class="fas fa-venus-mars"></i> @Model.PatientInfo.Sexe</span>
                    <span class="p-badge"><i class="fas fa-map-marker-alt"></i> @Model.PatientInfo.Adresse</span>
                </div>
                <div class="patient-contact">
                    <div class="contact-item"><i class="fas fa-phone"></i> @Model.PatientInfo.Telephone</div>
                    <div class="contact-item"><i class="fas fa-envelope"></i> @Model.PatientInfo.Email</div>
                    <div class="contact-item"><i class="fas fa-id-card"></i> Patient #@Model.PatientInfo.Id</div>
                </div>
            </div>

            <div class="header-actions">
                <a class="btn-action-primary" href="@Url.Action("Create", "Consultations", new { area = "Medical", patientId = Model.PatientInfo.Id })">
                    <i class="fas fa-plus"></i> Nouvelle consultation
                </a>
                <a class="btn-action-secondary" href="@Url.Action("Create", "Prescription", new { area = "Medical", patientId = Model.PatientInfo.Id })">
                    <i class="fas fa-prescription"></i> Ajouter ordonnance
                </a>
                <a class="btn-action-secondary" href="@Url.Action("FullRecord", "DossierMedicals", new { area = "Medical", id = Model.DossierId })" target="_blank">
                    <i class="fas fa-folder-open"></i> Voir dossier complet
                </a>
                <div class="btn-action-secondary" onclick="exportFullRecord()">
                    <i class="fas fa-file-export"></i> Exporter en PDF
                </div>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrWhiteSpace(Model.PatientInfo.AntecedentsMedicaux))
    {
        <div class="medical-alert">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="medical-alert-content">
                <h4>Alertes médicales</h4>
                <p>@Model.PatientInfo.AntecedentsMedicaux</p>
            </div>
        </div>
    }

    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-icon bg-indigo"><i class="fas fa-calendar-check"></i></div>
            <div class="stat-info">
                <div class="count">@consultationsCount</div>
                <div class="label">Consultations</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon bg-green"><i class="fas fa-prescription-bottle-alt"></i></div>
            <div class="stat-info">
                <div class="count">@prescriptionsCount</div>
                <div class="label">Ordonnances</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon bg-purple"><i class="fas fa-flask"></i></div>
            <div class="stat-info">
                <div class="count">@examensCount</div>
                <div class="label">Examens</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon bg-orange"><i class="fas fa-database"></i></div>
            <div class="stat-info">
                <div class="count">@totalEntries</div>
                <div class="label">Entrées totales</div>
            </div>
        </div>
    </div>

    <div class="folder-grid">
        <div class="folder-card">
            <div class="folder-head">
                <div>
                    <h4>Consultations détaillées</h4>
                    <p>Notes cliniques et motifs récents</p>
                </div>
                <span class="badge-soft">@consultationsCount</span>
            </div>

            @if (Model.Consultations.Any())
            {
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Motif</th>
                            <th>Médecin</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var consult in Model.Consultations.OrderByDescending(c => c.Date).Take(5))
                        {
                            <tr>
                                <td>
                                    <div class="fw-bold">@consult.Date.ToString("dd MMM")</div>
                                    <div class="text-dim">@consult.Date.ToString("yyyy")</div>
                                </td>
                                <td>
                                    <div class="fw-semibold">@consult.Motif</div>
                                    <div class="text-dim truncate-2">@consult.Notes</div>
                                </td>
                                <td><span class="pill-muted">@(!string.IsNullOrWhiteSpace(consult.Doctor?.Nom) ? consult.Doctor.Nom : "Non spécifié")</span></td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted mb-0">Aucune consultation disponible.</p>
            }
        </div>

        <div class="folder-card">
            <div class="folder-head">
                <div>
                    <h4>Ordonnances</h4>
                    <p>Traitements prescrits au patient</p>
                </div>
                <span class="badge-soft">@prescriptionsCount</span>
            </div>

            @if (Model.Prescriptions.Any())
            {
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Prescription</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var presc in Model.Prescriptions.OrderByDescending(p => p.DatePrescription).Take(5))
                        {
                            <tr>
                                <td>
                                    <div class="fw-bold">@presc.DatePrescription.ToString("dd MMM")</div>
                                    <div class="text-dim">@presc.DatePrescription.ToString("yyyy")</div>
                                </td>
                                <td>
                                    <div class="fw-semibold truncate-2">@presc.Medicaments</div>
                                    <div class="text-dim">Dr. @(!string.IsNullOrWhiteSpace(presc.Doctor?.Nom) ? presc.Doctor.Nom : "Non spécifié")</div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted mb-0">Aucune ordonnance enregistrée.</p>
            }
        </div>

        <div class="folder-card">
            <div class="folder-head">
                <div>
                    <h4>Examens &amp; analyses</h4>
                    <p>Laboratoire et imagerie associés</p>
                </div>
                <span class="badge-soft">@examensCount</span>
            </div>

            @if (Model.Examens.Any())
            {
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Examen</th>
                            <th>Résultat</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var exam in Model.Examens.OrderByDescending(e => e.DateExamen).Take(5))
                        {
                            <tr>
                                <td>
                                    <div class="fw-bold">@exam.DateExamen.ToString("dd MMM")</div>
                                    <div class="text-dim">@exam.DateExamen.ToString("yyyy")</div>
                                </td>
                                <td class="fw-semibold">@exam.TypeExamen</td>
                                <td class="text-dim truncate-2">@exam.Resultat</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="text-muted mb-0">Aucun examen n'est encore associé.</p>
            }
        </div>
    </div>

    <div class="content-layout">
        <div>
            <div class="section-header">
                <div class="section-title">
                    <i class="fas fa-notes-medical"></i>
                    <span>Historique des consultations</span>
                </div>
            </div>

            @if (Model.Consultations.Any())
            {
                <div class="timeline">
                    @foreach (var consult in Model.Consultations.OrderByDescending(c => c.Date))
                    {
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <div class="timeline-card">
                                <div class="t-header">
                                    <div class="t-title">
                                        <h4>@consult.Motif</h4>
                                        <div class="time">@consult.Date.ToString("dddd HH:mm")</div>
                                    </div>
                                    <div class="t-date">
                                        <span class="day">@consult.Date.Day</span>
                                        <span class="my">@consult.Date.ToString("MMM yyyy")</span>
                                    </div>
                                </div>
                                <div class="t-body">@consult.Notes</div>
                                <div class="t-footer">
                                    <span class="doctor-pill">Dr. @(consult.Doctor?.Nom ?? consult.DoctorId)</span>
                                    <span class="text-muted">Heure : @consult.Date.ToString("HH\hmm")</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="alert alert-light border">Aucune consultation enregistrée.</div>
            }
        </div>

        <div>
            <div class="sidebar-card">
                <div class="section-header mb-3">
                    <h5 class="section-title" style="font-size: 1rem;">
                        <i class="fas fa-bolt"></i> Actions rapides
                    </h5>
                    <span class="badge bg-primary-subtle text-primary">@totalEntries entrées</span>
                </div>

                <div class="quick-actions-grid">
                    <a class="btn-quick text-decoration-none" href="@Url.Action("Create", "Consultations", new { area = "Medical", patientId = Model.PatientInfo.Id })">
                        <i class="fas fa-stethoscope"></i>
                        <span>Nouvelle consultation</span>
                    </a>
                    <a class="btn-quick text-decoration-none" href="@Url.Action("Create", "Prescription", new { area = "Medical", patientId = Model.PatientInfo.Id })">
                        <i class="fas fa-pills"></i>
                        <span>Ordonnance</span>
                    </a>
                    <a class="btn-quick text-decoration-none" href="@Url.Action("Create", "Labo", new { area = "Medical", dossierId = Model.DossierId })">
                        <i class="fas fa-vial"></i>
                        <span>Ajouter examen</span>
                    </a>
                    <div class="btn-quick" onclick="exportFullRecord()">
                        <i class="fas fa-file-export"></i>
                        <span>Exporter</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-card">
                <div class="section-header mb-3">
                    <h5 class="section-title" style="font-size: 1rem;">
                        <i class="fas fa-prescription-bottle-alt"></i> Ordonnances actives
                    </h5>
                    <span class="badge bg-light text-dark">@prescriptionsCount</span>
                </div>

                @if (Model.Prescriptions.Any())
                {
                    foreach (var presc in Model.Prescriptions.OrderByDescending(p => p.DatePrescription).Take(3))
                    {
                        <div class="mini-list-item">
                            <div class="item-header">
                                <span>@presc.DatePrescription.ToString("dd MMM yyyy")</span>
                                <i class="fas fa-file-medical text-muted"></i>
                            </div>
                            <div class="item-body">@presc.Medicaments</div>
                            <div class="item-footer">
                                <span class="badge-info">Active</span>
                                <a href="@Url.Action("Print", "Prescription", new { area = "Medical", id = presc.IdPrescription })" target="_blank" class="ms-auto text-decoration-none small">
                                    <i class="fas fa-print"></i> Imprimer
                                </a>
                            </div>
                        </div>
                    }
                    if (prescriptionsCount > 3)
                    {
                        <a href="@Url.Action("FullRecord", "DossierMedicals", new { area = "Medical", id = Model.DossierId })" class="d-block text-center small fw-bold mt-2" target="_blank">Voir tout le dossier</a>
                    }
                }
                else
                {
                    <p class="text-muted small fst-italic">Aucune ordonnance active.</p>
                }
            </div>

            <div class="sidebar-card">
                <div class="section-header mb-3">
                    <h5 class="section-title" style="font-size: 1rem;">
                        <i class="fas fa-vial"></i> Résultats de laboratoire
                    </h5>
                    <span class="badge bg-light text-dark">@examensCount</span>
                </div>

                @if (Model.Examens.Any())
                {
                    foreach (var exam in Model.Examens.OrderByDescending(e => e.DateExamen).Take(3))
                    {
                        <div class="mini-list-item">
                            <div class="item-header">
                                <span>@exam.DateExamen.ToString("dd MMM")</span>
                                <span>@exam.TypeExamen</span>
                            </div>
                            <div class="item-body text-truncate">Résultat : @exam.Resultat</div>
                        </div>
                    }
                    if (examensCount > 3)
                    {
                        <a href="@Url.Action("FullRecord", "DossierMedicals", new { area = "Medical", id = Model.DossierId })" class="d-block text-center small fw-bold mt-2" target="_blank">Voir plus</a>
                    }
                }
                else
                {
                    <p class="text-muted small fst-italic">Aucun résultat de laboratoire.</p>
                }
            </div>
        </div>
    </div>
</div>

<script>
    const exportUrl = '@Url.Action("FullRecord", "DossierMedicals", new { area = "Medical", id = Model.DossierId, print = true })';

    function exportFullRecord() {
        const exportWindow = window.open(exportUrl, '_blank');
        if (!exportWindow) {
            alert('Veuillez autoriser les fenêtres pop-up pour lancer l\'export.');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        console.log("Medical Record View Loaded for @Model.PatientInfo.Nom");
    });
</script>
